{
  "_meta": {
    "version": "1.0.0",
    "description": "Population to SDI target mapping for Living Soundscape Engine",
    "last_updated": "2025-02-05"
  },

  "population_mapping": {
    "_description": "Maps player population density to target SDI values",
    
    "curve": {
      "type": "piecewise_linear",
      "points": [
        { "population": 0.0,  "target_sdi": -0.30 },
        { "population": 0.2,  "target_sdi": 0.00 },
        { "population": 0.5,  "target_sdi": 0.20 },
        { "population": 0.8,  "target_sdi": 0.50 },
        { "population": 1.0,  "target_sdi": 0.80 }
      ]
    },

    "formula": {
      "_description": "Alternative: use formula instead of points",
      "expression": "clamp(-0.3 + (population * 1.1), -0.3, 0.8)",
      "enabled": false
    }
  },

  "adjustment_behavior": {
    "_description": "How the LSE adjusts soundscape to reach target SDI",
    
    "delta_thresholds": {
      "small": 0.1,
      "medium": 0.2,
      "large": 0.3,
      "critical": 0.4
    },

    "increase_sdi_actions": {
      "_description": "Actions to take when current SDI is below target",
      "small": [
        "reduce_silence_gaps"
      ],
      "medium": [
        "reduce_silence_gaps",
        "introduce_rhythm_drift"
      ],
      "large": [
        "reduce_silence_gaps",
        "introduce_rhythm_drift",
        "increase_layer_density"
      ],
      "critical": [
        "reduce_silence_gaps",
        "introduce_rhythm_drift",
        "increase_layer_density",
        "allow_contextual_edge_cases"
      ]
    },

    "decrease_sdi_actions": {
      "_description": "Actions to take when current SDI is above target",
      "small": [
        "extend_silence_gaps"
      ],
      "medium": [
        "extend_silence_gaps",
        "stabilize_rhythms"
      ],
      "large": [
        "extend_silence_gaps",
        "stabilize_rhythms",
        "reduce_active_layers"
      ],
      "critical": [
        "extend_silence_gaps",
        "stabilize_rhythms",
        "reduce_active_layers",
        "force_harmony_only"
      ]
    }
  },

  "action_parameters": {
    "reduce_silence_gaps": {
      "gap_multiplier": 0.7,
      "min_gap": 1.0
    },
    "extend_silence_gaps": {
      "gap_multiplier": 1.5,
      "max_gap_multiplier": 3.0
    },
    "introduce_rhythm_drift": {
      "drift_range": [0.15, 0.35],
      "affected_sounds": ["rhythm_capable"]
    },
    "stabilize_rhythms": {
      "max_variance": 0.05
    },
    "increase_layer_density": {
      "density_multiplier": 1.3,
      "max_multiplier": 2.0
    },
    "reduce_active_layers": {
      "target_reduction": 0.5,
      "preserve_layers": ["background"]
    },
    "allow_contextual_edge_cases": {
      "enable_time_violations": false,
      "enable_weather_violations": false,
      "enable_mild_conflicts": true
    },
    "force_harmony_only": {
      "require_harmony_pair": true,
      "block_conflicts": true
    }
  },

  "region_overrides": {
    "_description": "Override default population mapping for specific region types",
    
    "dungeon": {
      "curve_modifier": 0.1,
      "min_sdi": 0.2,
      "max_sdi": 0.7,
      "reason": "Dungeons should feel tense regardless of population"
    },
    "town": {
      "curve_modifier": -0.1,
      "min_sdi": -0.3,
      "max_sdi": 0.3,
      "reason": "Towns should feel welcoming"
    },
    "pvp_zone": {
      "curve_modifier": 0.15,
      "min_sdi": 0.1,
      "max_sdi": 0.8,
      "reason": "PvP zones benefit from tension"
    },
    "sanctuary": {
      "fixed_sdi": -0.25,
      "ignore_population": true,
      "reason": "Safe zones should always be calm"
    }
  },

  "hysteresis": {
    "_description": "Prevent rapid oscillation in SDI targeting",
    
    "enabled": true,
    "dead_zone": 0.05,
    "ramp_up_speed": 0.1,
    "ramp_down_speed": 0.15,
    "min_hold_time": 5.0
  },

  "population_sampling": {
    "_description": "How population is measured",
    
    "sample_radius": 100.0,
    "sample_interval": 5.0,
    "smoothing_window": 30.0,
    "include_npcs": false,
    "weight_by_proximity": true
  }
}
